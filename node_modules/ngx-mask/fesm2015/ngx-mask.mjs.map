{"version":3,"file":"ngx-mask.mjs","sources":["../../../projects/ngx-mask-lib/src/lib/config.ts","../../../projects/ngx-mask-lib/src/lib/mask-applier.service.ts","../../../projects/ngx-mask-lib/src/lib/mask.service.ts","../../../projects/ngx-mask-lib/src/lib/mask.directive.ts","../../../projects/ngx-mask-lib/src/lib/mask.pipe.ts","../../../projects/ngx-mask-lib/src/lib/ngx-mask.module.ts","../../../projects/ngx-mask-lib/src/lib/custom-keyboard-event.ts","../../../projects/ngx-mask-lib/src/ngx-mask.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\n\nexport interface IConfig {\n\tsuffix: string;\n\tprefix: string;\n\tthousandSeparator: string;\n\tdecimalMarker: '.' | ',';\n\tclearIfNotMatch: boolean;\n\tshowTemplate: boolean;\n\tshowMaskTyped: boolean;\n\tplaceHolderCharacter: string;\n\tshownMaskExpression: string;\n\tdropSpecialCharacters: boolean | string[];\n\tspecialCharacters: string[];\n\thiddenInput: boolean | undefined;\n\tvalidation: boolean;\n\tseparatorLimit: string;\n\tallowNegativeNumbers: boolean;\n\tleadZeroDateTime: boolean;\n\tpatterns: {\n\t\t[character: string]: {\n\t\t\tpattern: RegExp;\n\t\t\toptional?: boolean;\n\t\t\tsymbol?: string;\n\t\t};\n\t};\n}\n\nexport type optionsConfig = Partial<IConfig>;\nexport const config: InjectionToken<IConfig> = new InjectionToken('config');\nexport const NEW_CONFIG: InjectionToken<IConfig> = new InjectionToken('NEW_CONFIG');\nexport const INITIAL_CONFIG: InjectionToken<IConfig> = new InjectionToken('INITIAL_CONFIG');\n\nexport const initialConfig: IConfig = {\n\tsuffix: '',\n\tprefix: '',\n\tthousandSeparator: ' ',\n\tdecimalMarker: '.',\n\tclearIfNotMatch: false,\n\tshowTemplate: false,\n\tshowMaskTyped: false,\n\tplaceHolderCharacter: '_',\n\tdropSpecialCharacters: true,\n\thiddenInput: undefined,\n\tshownMaskExpression: '',\n\tseparatorLimit: '',\n\tallowNegativeNumbers: false,\n\tvalidation: true,\n\t// eslint-disable-next-line @typescript-eslint/quotes\n\tspecialCharacters: ['-', '/', '(', ')', '.', ':', ' ', '+', ',', '@', '[', ']', '\"', \"'\"],\n\tleadZeroDateTime: false,\n\tpatterns: {\n\t\t'0': {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t\t'9': {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t\toptional: true,\n\t\t},\n\t\tX: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t\tsymbol: '*',\n\t\t},\n\t\tA: {\n\t\t\tpattern: new RegExp('[a-zA-Z0-9]'),\n\t\t},\n\t\tS: {\n\t\t\tpattern: new RegExp('[a-zA-Z]'),\n\t\t},\n\t\td: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t\tm: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t\tM: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t\tH: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t\th: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t\ts: {\n\t\t\tpattern: new RegExp('\\\\d'),\n\t\t},\n\t},\n};\n\nexport const timeMasks: string[] = ['Hh:m0:s0', 'Hh:m0', 'm0:s0'];\n\nexport const withoutValidation: string[] = [\n\t'percent',\n\t'Hh',\n\t's0',\n\t'm0',\n\t'separator',\n\t'd0/M0/0000',\n\t'd0/M0',\n\t'd0',\n\t'M0',\n];\n","import { Inject, Injectable } from '@angular/core';\nimport { config, IConfig } from './config';\n\n@Injectable()\nexport class MaskApplierService {\n\tpublic dropSpecialCharacters: IConfig['dropSpecialCharacters'];\n\n\tpublic hiddenInput: IConfig['hiddenInput'];\n\n\tpublic showTemplate!: IConfig['showTemplate'];\n\n\tpublic clearIfNotMatch!: IConfig['clearIfNotMatch'];\n\n\tpublic maskExpression: string = '';\n\n\tpublic actualValue: string = '';\n\n\tpublic shownMaskExpression: string = '';\n\n\tpublic maskSpecialCharacters!: IConfig['specialCharacters'];\n\n\tpublic maskAvailablePatterns!: IConfig['patterns'];\n\n\tpublic prefix!: IConfig['prefix'];\n\n\tpublic suffix!: IConfig['suffix'];\n\n\tpublic thousandSeparator!: IConfig['thousandSeparator'];\n\n\tpublic decimalMarker!: IConfig['decimalMarker'];\n\n\tpublic customPattern!: IConfig['patterns'];\n\n\tpublic ipError?: boolean;\n\n\tpublic cpfCnpjError?: boolean;\n\n\tpublic showMaskTyped!: IConfig['showMaskTyped'];\n\n\tpublic placeHolderCharacter!: IConfig['placeHolderCharacter'];\n\n\tpublic validation: IConfig['validation'];\n\n\tpublic separatorLimit: IConfig['separatorLimit'];\n\n\tpublic allowNegativeNumbers: IConfig['allowNegativeNumbers'];\n\n\tpublic leadZeroDateTime: IConfig['leadZeroDateTime'];\n\n\tprivate _shift!: Set<number>;\n\n\tpublic constructor(@Inject(config) protected _config: IConfig) {\n\t\tthis._shift = new Set();\n\t\tthis.clearIfNotMatch = this._config.clearIfNotMatch;\n\t\tthis.dropSpecialCharacters = this._config.dropSpecialCharacters;\n\t\tthis.maskSpecialCharacters = this._config.specialCharacters;\n\t\tthis.maskAvailablePatterns = this._config.patterns;\n\t\tthis.prefix = this._config.prefix;\n\t\tthis.suffix = this._config.suffix;\n\t\tthis.thousandSeparator = this._config.thousandSeparator;\n\t\tthis.decimalMarker = this._config.decimalMarker;\n\t\tthis.hiddenInput = this._config.hiddenInput;\n\t\tthis.showMaskTyped = this._config.showMaskTyped;\n\t\tthis.placeHolderCharacter = this._config.placeHolderCharacter;\n\t\tthis.validation = this._config.validation;\n\t\tthis.separatorLimit = this._config.separatorLimit;\n\t\tthis.allowNegativeNumbers = this._config.allowNegativeNumbers;\n\t\tthis.leadZeroDateTime = this._config.leadZeroDateTime;\n\t}\n\n\tpublic applyMaskWithPattern(\n\t\tinputValue: string,\n\t\tmaskAndPattern: [string, IConfig['patterns']],\n\t): string {\n\t\tconst [mask, customPattern] = maskAndPattern;\n\t\tthis.customPattern = customPattern;\n\t\treturn this.applyMask(inputValue, mask);\n\t}\n\n\tpublic applyMask(\n\t\tinputValue: string | object | boolean | null | undefined,\n\t\tmaskExpression: string,\n\t\tposition: number = 0,\n\t\tjustPasted: boolean = false,\n\t\tbackspaced: boolean = false,\n\t\tcb: Function = () => {},\n\t): string {\n\t\tif (!maskExpression || typeof inputValue !== 'string') {\n\t\t\treturn '';\n\t\t}\n\t\tlet cursor = 0;\n\t\tlet result = '';\n\t\tlet multi = false;\n\t\tlet backspaceShift = false;\n\t\tlet shift = 1;\n\t\tlet stepBack = false;\n\t\tif (inputValue.slice(0, this.prefix.length) === this.prefix) {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue = inputValue.slice(this.prefix.length, inputValue.length);\n\t\t}\n\t\tif (!!this.suffix && inputValue?.length > 0) {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue = this.checkAndRemoveSuffix(inputValue);\n\t\t}\n\t\tconst inputArray: string[] = inputValue.toString().split('');\n\t\tif (maskExpression === 'IP') {\n\t\t\tthis.ipError =\n\t\t\t\tinputArray.filter((i: string) => i === '.').length < 3 && inputArray.length < 7;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tmaskExpression = '099.099.099.099';\n\t\t}\n\t\tconst arr: string[] = [];\n\t\tfor (let i = 0; i < inputValue.length; i++) {\n\t\t\tif (inputValue[i]?.match('\\\\d')) {\n\t\t\t\tarr.push(inputValue[i]!);\n\t\t\t}\n\t\t}\n\t\tif (maskExpression === 'CPF_CNPJ') {\n\t\t\tthis.cpfCnpjError = arr.length !== 11 && arr.length !== 14;\n\t\t\tif (arr.length > 11) {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tmaskExpression = '00.000.000/0000-00';\n\t\t\t} else {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tmaskExpression = '000.000.000-00';\n\t\t\t}\n\t\t}\n\t\tif (maskExpression.startsWith('percent')) {\n\t\t\tif (\n\t\t\t\tinputValue.match('[a-z]|[A-Z]') ||\n\t\t\t\tinputValue.match(/[-!$%^&*()_+|~=`{}\\[\\]:\";'<>?,\\/.]/)\n\t\t\t) {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = this._stripToDecimal(inputValue);\n\t\t\t\tconst precision: number = this.getPrecision(maskExpression);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = this.checkInputPrecision(inputValue, precision, this.decimalMarker);\n\t\t\t}\n\t\t\tif (\n\t\t\t\tinputValue.indexOf('.') > 0 &&\n\t\t\t\t!this.percentage(inputValue.substring(0, inputValue.indexOf('.')))\n\t\t\t) {\n\t\t\t\tconst base: string = inputValue.substring(0, inputValue.indexOf('.') - 1);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = `${base}${inputValue.substring(inputValue.indexOf('.'), inputValue.length)}`;\n\t\t\t}\n\t\t\tif (this.percentage(inputValue)) {\n\t\t\t\tresult = inputValue;\n\t\t\t} else {\n\t\t\t\tresult = inputValue.substring(0, inputValue.length - 1);\n\t\t\t}\n\t\t} else if (maskExpression.startsWith('separator')) {\n\t\t\tif (\n\t\t\t\tinputValue.match('[wа-яА-Я]') ||\n\t\t\t\tinputValue.match('[ЁёА-я]') ||\n\t\t\t\tinputValue.match('[a-z]|[A-Z]') ||\n\t\t\t\tinputValue.match(/[-@#!$%\\\\^&*()_£¬'+|~=`{}\\[\\]:\";<>.?\\/]/) ||\n\t\t\t\tinputValue.match('[^A-Za-z0-9,]')\n\t\t\t) {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = this._stripToDecimal(inputValue);\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue =\n\t\t\t\tinputValue.length > 1 &&\n\t\t\t\tinputValue[0] === '0' &&\n\t\t\t\tinputValue[1] !== this.decimalMarker &&\n\t\t\t\t!backspaced\n\t\t\t\t\t? inputValue.slice(1, inputValue.length)\n\t\t\t\t\t: inputValue;\n\n\t\t\t// TODO: we had different rexexps here for the different cases... but tests dont seam to bother - check this\n\t\t\t//  separator: no COMMA, dot-sep: no SPACE, COMMA OK, comma-sep: no SPACE, COMMA OK\n\n\t\t\tconst thousandSeperatorCharEscaped: string = this._charToRegExpExpression(\n\t\t\t\tthis.thousandSeparator,\n\t\t\t);\n\t\t\tconst decimalMarkerEscaped: string = this._charToRegExpExpression(this.decimalMarker);\n\t\t\tconst invalidChars: string = '@#!$%^&*()_+|~=`{}\\\\[\\\\]:\\\\s,\\\\.\";<>?\\\\/'\n\t\t\t\t.replace(thousandSeperatorCharEscaped, '')\n\t\t\t\t.replace(decimalMarkerEscaped, '');\n\n\t\t\tconst invalidCharRegexp: RegExp = new RegExp('[' + invalidChars + ']');\n\n\t\t\tif (inputValue.match(invalidCharRegexp)) {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = inputValue.substring(0, inputValue.length - 1);\n\t\t\t}\n\n\t\t\tconst precision: number = this.getPrecision(maskExpression);\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue = this.checkInputPrecision(inputValue, precision, this.decimalMarker);\n\t\t\tconst strForSep: string = inputValue.replace(\n\t\t\t\tnew RegExp(thousandSeperatorCharEscaped, 'g'),\n\t\t\t\t'',\n\t\t\t);\n\t\t\tresult = this._formatWithSeparators(\n\t\t\t\tstrForSep,\n\t\t\t\tthis.thousandSeparator,\n\t\t\t\tthis.decimalMarker,\n\t\t\t\tprecision,\n\t\t\t);\n\n\t\t\tconst commaShift: number = result.indexOf(',') - inputValue.indexOf(',');\n\t\t\tconst shiftStep: number = result.length - inputValue.length;\n\n\t\t\tif (shiftStep > 0 && result[position] !== ',') {\n\t\t\t\tbackspaceShift = true;\n\t\t\t\tlet _shift = 0;\n\t\t\t\tdo {\n\t\t\t\t\tthis._shift.add(position + _shift);\n\t\t\t\t\t_shift++;\n\t\t\t\t} while (_shift < shiftStep);\n\t\t\t} else if (\n\t\t\t\t(commaShift !== 0 && position > 0 && !(result.indexOf(',') >= position && position > 3)) ||\n\t\t\t\t(!(result.indexOf('.') >= position && position > 3) && shiftStep <= 0)\n\t\t\t) {\n\t\t\t\tthis._shift.clear();\n\t\t\t\tbackspaceShift = true;\n\t\t\t\tshift = shiftStep;\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tposition += shiftStep;\n\t\t\t\tthis._shift.add(position);\n\t\t\t} else {\n\t\t\t\tthis._shift.clear();\n\t\t\t}\n\t\t} else {\n\t\t\tfor (\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tlet i: number = 0, inputSymbol: string = inputArray[0]!;\n\t\t\t\ti < inputArray.length;\n\t\t\t\ti++, inputSymbol = inputArray[i]!\n\t\t\t) {\n\t\t\t\tif (cursor === maskExpression.length) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tthis._checkSymbolMask(inputSymbol, maskExpression[cursor]!) &&\n\t\t\t\t\tmaskExpression[cursor + 1] === '?'\n\t\t\t\t) {\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t\tcursor += 2;\n\t\t\t\t} else if (\n\t\t\t\t\tmaskExpression[cursor + 1] === '*' &&\n\t\t\t\t\tmulti &&\n\t\t\t\t\tthis._checkSymbolMask(inputSymbol, maskExpression[cursor + 2]!)\n\t\t\t\t) {\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t\tcursor += 3;\n\t\t\t\t\tmulti = false;\n\t\t\t\t} else if (\n\t\t\t\t\tthis._checkSymbolMask(inputSymbol, maskExpression[cursor]!) &&\n\t\t\t\t\tmaskExpression[cursor + 1] === '*'\n\t\t\t\t) {\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t\tmulti = true;\n\t\t\t\t} else if (\n\t\t\t\t\tmaskExpression[cursor + 1] === '?' &&\n\t\t\t\t\tthis._checkSymbolMask(inputSymbol, maskExpression[cursor + 2]!)\n\t\t\t\t) {\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t\tcursor += 3;\n\t\t\t\t} else if (this._checkSymbolMask(inputSymbol, maskExpression[cursor]!)) {\n\t\t\t\t\tif (maskExpression[cursor] === 'H') {\n\t\t\t\t\t\tif (Number(inputSymbol) > 2) {\n\t\t\t\t\t\t\tcursor += 1;\n\t\t\t\t\t\t\tthis._shiftStep(maskExpression, cursor, inputArray.length);\n\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\tif (this.leadZeroDateTime) {\n\t\t\t\t\t\t\t\tresult += '0';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (maskExpression[cursor] === 'h') {\n\t\t\t\t\t\tif (result === '2' && Number(inputSymbol) > 3) {\n\t\t\t\t\t\t\tcursor += 1;\n\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (maskExpression[cursor] === 'm') {\n\t\t\t\t\t\tif (Number(inputSymbol) > 5) {\n\t\t\t\t\t\t\tcursor += 1;\n\t\t\t\t\t\t\tthis._shiftStep(maskExpression, cursor, inputArray.length);\n\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\tif (this.leadZeroDateTime) {\n\t\t\t\t\t\t\t\tresult += '0';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (maskExpression[cursor] === 's') {\n\t\t\t\t\t\tif (Number(inputSymbol) > 5) {\n\t\t\t\t\t\t\tcursor += 1;\n\t\t\t\t\t\t\tthis._shiftStep(maskExpression, cursor, inputArray.length);\n\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\tif (this.leadZeroDateTime) {\n\t\t\t\t\t\t\t\tresult += '0';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst daysCount = 31;\n\t\t\t\t\tif (maskExpression[cursor] === 'd') {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(Number(inputSymbol) > 3 && this.leadZeroDateTime) ||\n\t\t\t\t\t\t\tNumber(inputValue.slice(cursor, cursor + 2)) > daysCount ||\n\t\t\t\t\t\t\tinputValue[cursor + 1] === '/'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcursor += 1;\n\t\t\t\t\t\t\tthis._shiftStep(maskExpression, cursor, inputArray.length);\n\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\tif (this.leadZeroDateTime) {\n\t\t\t\t\t\t\t\tresult += '0';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (maskExpression[cursor] === 'M') {\n\t\t\t\t\t\tconst monthsCount = 12;\n\t\t\t\t\t\t// mask without day\n\t\t\t\t\t\tconst withoutDays: boolean =\n\t\t\t\t\t\t\tcursor === 0 &&\n\t\t\t\t\t\t\t(Number(inputSymbol) > 2 ||\n\t\t\t\t\t\t\t\tNumber(inputValue.slice(cursor, cursor + 2)) > monthsCount ||\n\t\t\t\t\t\t\t\tinputValue[cursor + 1] === '/');\n\t\t\t\t\t\t// day<10 && month<12 for input\n\t\t\t\t\t\tconst day1monthInput: boolean =\n\t\t\t\t\t\t\tinputValue.slice(cursor - 3, cursor - 1).includes('/') &&\n\t\t\t\t\t\t\t((inputValue[cursor - 2] === '/' &&\n\t\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 1, cursor + 1)) > monthsCount &&\n\t\t\t\t\t\t\t\tinputValue[cursor] !== '/') ||\n\t\t\t\t\t\t\t\tinputValue[cursor] === '/' ||\n\t\t\t\t\t\t\t\t(inputValue[cursor - 3] === '/' &&\n\t\t\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 2, cursor)) > monthsCount &&\n\t\t\t\t\t\t\t\t\tinputValue[cursor - 1] !== '/') ||\n\t\t\t\t\t\t\t\tinputValue[cursor - 1] === '/');\n\t\t\t\t\t\t// 10<day<31 && month<12 for input\n\t\t\t\t\t\tconst day2monthInput: boolean =\n\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 3, cursor - 1)) <= daysCount &&\n\t\t\t\t\t\t\t!inputValue.slice(cursor - 3, cursor - 1).includes('/') &&\n\t\t\t\t\t\t\tinputValue[cursor - 1] === '/' &&\n\t\t\t\t\t\t\t(Number(inputValue.slice(cursor, cursor + 2)) > monthsCount ||\n\t\t\t\t\t\t\t\tinputValue[cursor + 1] === '/');\n\t\t\t\t\t\t// day<10 && month<12 for paste whole data\n\t\t\t\t\t\tconst day1monthPaste: boolean =\n\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 3, cursor - 1)) > daysCount &&\n\t\t\t\t\t\t\t!inputValue.slice(cursor - 3, cursor - 1).includes('/') &&\n\t\t\t\t\t\t\t!inputValue.slice(cursor - 2, cursor).includes('/') &&\n\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 2, cursor)) > monthsCount;\n\t\t\t\t\t\t// 10<day<31 && month<12 for paste whole data\n\t\t\t\t\t\tconst day2monthPaste: boolean =\n\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 3, cursor - 1)) <= daysCount &&\n\t\t\t\t\t\t\t!inputValue.slice(cursor - 3, cursor - 1).includes('/') &&\n\t\t\t\t\t\t\tinputValue[cursor - 1] !== '/' &&\n\t\t\t\t\t\t\tNumber(inputValue.slice(cursor - 1, cursor + 1)) > monthsCount;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(Number(inputSymbol) > 1 && this.leadZeroDateTime) ||\n\t\t\t\t\t\t\twithoutDays ||\n\t\t\t\t\t\t\tday1monthInput ||\n\t\t\t\t\t\t\tday2monthInput ||\n\t\t\t\t\t\t\tday1monthPaste ||\n\t\t\t\t\t\t\tday2monthPaste\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcursor += 1;\n\t\t\t\t\t\t\tthis._shiftStep(maskExpression, cursor, inputArray.length);\n\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\tif (this.leadZeroDateTime) {\n\t\t\t\t\t\t\t\tresult += '0';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t\tcursor++;\n\t\t\t\t} else if (this.maskSpecialCharacters.indexOf(maskExpression[cursor]!) !== -1) {\n\t\t\t\t\tresult += maskExpression[cursor];\n\t\t\t\t\tcursor++;\n\t\t\t\t\tthis._shiftStep(maskExpression, cursor, inputArray.length);\n\t\t\t\t\ti--;\n\t\t\t\t} else if (\n\t\t\t\t\tthis.maskSpecialCharacters.indexOf(inputSymbol) > -1 &&\n\t\t\t\t\tthis.maskAvailablePatterns[maskExpression[cursor]!] &&\n\t\t\t\t\tthis.maskAvailablePatterns[maskExpression[cursor]!]?.optional\n\t\t\t\t) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t!!inputArray[cursor] &&\n\t\t\t\t\t\tmaskExpression !== '099.099.099.099' &&\n\t\t\t\t\t\tmaskExpression !== '000.000.000-00' &&\n\t\t\t\t\t\tmaskExpression !== '00.000.000/0000-00'\n\t\t\t\t\t) {\n\t\t\t\t\t\tresult += inputArray[cursor];\n\t\t\t\t\t}\n\t\t\t\t\tcursor++;\n\t\t\t\t\ti--;\n\t\t\t\t} else if (\n\t\t\t\t\tthis.maskExpression[cursor + 1] === '*' &&\n\t\t\t\t\tthis._findSpecialChar(this.maskExpression[cursor + 2]!) &&\n\t\t\t\t\tthis._findSpecialChar(inputSymbol) === this.maskExpression[cursor + 2] &&\n\t\t\t\t\tmulti\n\t\t\t\t) {\n\t\t\t\t\tcursor += 3;\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t} else if (\n\t\t\t\t\tthis.maskExpression[cursor + 1] === '?' &&\n\t\t\t\t\tthis._findSpecialChar(this.maskExpression[cursor + 2]!) &&\n\t\t\t\t\tthis._findSpecialChar(inputSymbol) === this.maskExpression[cursor + 2] &&\n\t\t\t\t\tmulti\n\t\t\t\t) {\n\t\t\t\t\tcursor += 3;\n\t\t\t\t\tresult += inputSymbol;\n\t\t\t\t} else if (\n\t\t\t\t\tthis.showMaskTyped &&\n\t\t\t\t\tthis.maskSpecialCharacters.indexOf(inputSymbol) < 0 &&\n\t\t\t\t\tinputSymbol !== this.placeHolderCharacter\n\t\t\t\t) {\n\t\t\t\t\tstepBack = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\tresult.length + 1 === maskExpression.length &&\n\t\t\tthis.maskSpecialCharacters.indexOf(maskExpression[maskExpression.length - 1]!) !== -1\n\t\t) {\n\t\t\tresult += maskExpression[maskExpression.length - 1];\n\t\t}\n\n\t\tlet newPosition: number = position + 1;\n\n\t\twhile (this._shift.has(newPosition)) {\n\t\t\tshift++;\n\t\t\tnewPosition++;\n\t\t}\n\n\t\tlet actualShift: number = justPasted ? cursor : this._shift.has(position) ? shift : 0;\n\t\tif (stepBack) {\n\t\t\tactualShift--;\n\t\t}\n\n\t\tcb(actualShift, backspaceShift);\n\t\tif (shift < 0) {\n\t\t\tthis._shift.clear();\n\t\t}\n\t\tlet onlySpecial = false;\n\t\tif (backspaced) {\n\t\t\tonlySpecial = inputArray.every((char) => this.maskSpecialCharacters.includes(char));\n\t\t}\n\t\tlet res = `${this.prefix}${onlySpecial ? '' : result}${this.suffix}`;\n\t\tif (result.length === 0) {\n\t\t\tres = `${this.prefix}${result}`;\n\t\t}\n\t\treturn res;\n\t}\n\n\tpublic _findSpecialChar(inputSymbol: string): undefined | string {\n\t\treturn this.maskSpecialCharacters.find((val: string) => val === inputSymbol);\n\t}\n\n\tprotected _checkSymbolMask(inputSymbol: string, maskSymbol: string): boolean {\n\t\tthis.maskAvailablePatterns = this.customPattern\n\t\t\t? this.customPattern\n\t\t\t: this.maskAvailablePatterns;\n\t\treturn (\n\t\t\tthis.maskAvailablePatterns[maskSymbol]! &&\n\t\t\tthis.maskAvailablePatterns[maskSymbol]!.pattern &&\n\t\t\tthis.maskAvailablePatterns[maskSymbol]!.pattern.test(inputSymbol)\n\t\t);\n\t}\n\n\tprivate _formatWithSeparators = (\n\t\tstr: string,\n\t\tthousandSeparatorChar: string,\n\t\tdecimalChar: string,\n\t\tprecision: number,\n\t) => {\n\t\tconst x: string[] = str.split(decimalChar);\n\t\tconst decimals: string = x.length > 1 ? `${decimalChar}${x[1]}` : '';\n\t\tlet res: string = x[0]!;\n\t\tconst separatorLimit: string = this.separatorLimit.replace(/\\s/g, '');\n\t\tif (separatorLimit && +separatorLimit) {\n\t\t\tif (res[0] === '-') {\n\t\t\t\tres = `-${res.slice(1, res.length).slice(0, separatorLimit.length)}`;\n\t\t\t} else {\n\t\t\t\tres = res.slice(0, separatorLimit.length);\n\t\t\t}\n\t\t}\n\t\tconst rgx: RegExp = /(\\d+)(\\d{3})/;\n\n\t\twhile (thousandSeparatorChar && rgx.test(res)) {\n\t\t\tres = res.replace(rgx, '$1' + thousandSeparatorChar + '$2');\n\t\t}\n\n\t\tif (precision === undefined) {\n\t\t\treturn res + decimals;\n\t\t} else if (precision === 0) {\n\t\t\treturn res;\n\t\t}\n\t\treturn res + decimals.substr(0, precision + 1);\n\t};\n\n\tprivate percentage = (str: string): boolean => {\n\t\treturn Number(str) >= 0 && Number(str) <= 100;\n\t};\n\n\tprivate getPrecision = (maskExpression: string): number => {\n\t\tconst x: string[] = maskExpression.split('.');\n\t\tif (x.length > 1) {\n\t\t\treturn Number(x[x.length - 1]);\n\t\t}\n\n\t\treturn Infinity;\n\t};\n\n\tprivate checkAndRemoveSuffix = (inputValue: string): string => {\n\t\tfor (let i = this.suffix?.length - 1; i >= 0; i--) {\n\t\t\tconst substr = this.suffix.substr(i, this.suffix?.length);\n\t\t\tif (\n\t\t\t\tinputValue.includes(substr) &&\n\t\t\t\t(i - 1 < 0 || !inputValue.includes(this.suffix.substr(i - 1, this.suffix?.length)))\n\t\t\t) {\n\t\t\t\treturn inputValue.replace(substr, '');\n\t\t\t}\n\t\t}\n\t\treturn inputValue;\n\t};\n\n\tprivate checkInputPrecision = (\n\t\tinputValue: string,\n\t\tprecision: number,\n\t\tdecimalMarker: IConfig['decimalMarker'],\n\t): string => {\n\t\tif (precision < Infinity) {\n\t\t\tconst precisionRegEx: RegExp = new RegExp(\n\t\t\t\tthis._charToRegExpExpression(decimalMarker) + `\\\\d{${precision}}.*$`,\n\t\t\t);\n\n\t\t\tconst precisionMatch: RegExpMatchArray | null = inputValue.match(precisionRegEx);\n\t\t\tif (precisionMatch && precisionMatch[0]!.length - 1 > precision) {\n\t\t\t\tconst diff = precisionMatch[0]!.length - 1 - precision;\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = inputValue.substring(0, inputValue.length - diff);\n\t\t\t}\n\t\t\tif (precision === 0 && inputValue.endsWith(decimalMarker)) {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = inputValue.substring(0, inputValue.length - 1);\n\t\t\t}\n\t\t}\n\t\treturn inputValue;\n\t};\n\n\tprivate _stripToDecimal(str: string): string {\n\t\treturn str\n\t\t\t.split('')\n\t\t\t.filter((i: string, idx: number) => {\n\t\t\t\treturn (\n\t\t\t\t\ti.match('^-?\\\\d') ||\n\t\t\t\t\ti.match('\\\\s') ||\n\t\t\t\t\ti === '.' ||\n\t\t\t\t\ti === ',' ||\n\t\t\t\t\t(i === '-' && idx === 0 && this.allowNegativeNumbers)\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join('');\n\t}\n\n\tprivate _charToRegExpExpression(char: string): string {\n\t\tif (char) {\n\t\t\tconst charsToEscape = '[\\\\^$.|?*+()';\n\t\t\treturn char === ' ' ? '\\\\s' : charsToEscape.indexOf(char) >= 0 ? '\\\\' + char : char;\n\t\t}\n\t\treturn char;\n\t}\n\n\tprivate _shiftStep(maskExpression: string, cursor: number, inputLength: number) {\n\t\tconst shiftStep: number = /[*?]/g.test(maskExpression.slice(0, cursor)) ? inputLength : cursor;\n\t\tthis._shift.add(shiftStep + this.prefix.length || 0);\n\t}\n}\n","import { ElementRef, Inject, Injectable, Renderer2 } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\n\nimport { config, IConfig } from './config';\nimport { MaskApplierService } from './mask-applier.service';\n\n@Injectable()\nexport class MaskService extends MaskApplierService {\n\tpublic override maskExpression: string = '';\n\n\tpublic isNumberValue: boolean = false;\n\n\tpublic override placeHolderCharacter: string = '_';\n\n\tpublic maskIsShown: string = '';\n\n\tpublic selStart: number | null = null;\n\n\tpublic selEnd: number | null = null;\n\n\t/**\n\t * Whether we are currently in writeValue function, in this case when applying the mask we don't want to trigger onChange function,\n\t * since writeValue should be a one way only process of writing the DOM value based on the Angular model value.\n\t */\n\tpublic writingValue: boolean = false;\n\n\tpublic maskChanged: boolean = false;\n\n\tpublic onChange = (_: any) => {};\n\n\tpublic constructor(\n\t\t@Inject(DOCUMENT) private document: any,\n\t\t@Inject(config) protected override _config: IConfig,\n\t\tprivate _elementRef: ElementRef,\n\t\tprivate _renderer: Renderer2,\n\t) {\n\t\tsuper(_config);\n\t}\n\n\t// eslint-disable-next-line complexity\n\tpublic override applyMask(\n\t\tinputValue: string,\n\t\tmaskExpression: string,\n\t\tposition: number = 0,\n\t\tjustPasted = false,\n\t\tbackspaced = false,\n\t\tcb: Function = () => {},\n\t): string {\n\t\tif (!maskExpression) {\n\t\t\treturn inputValue;\n\t\t}\n\t\tthis.maskIsShown = this.showMaskTyped ? this.showMaskInInput() : '';\n\t\tif (this.maskExpression === 'IP' && this.showMaskTyped) {\n\t\t\tthis.maskIsShown = this.showMaskInInput(inputValue || '#');\n\t\t}\n\t\tif (this.maskExpression === 'CPF_CNPJ' && this.showMaskTyped) {\n\t\t\tthis.maskIsShown = this.showMaskInInput(inputValue || '#');\n\t\t}\n\t\tif (!inputValue && this.showMaskTyped) {\n\t\t\tthis.formControlResult(this.prefix);\n\t\t\treturn this.prefix + this.maskIsShown;\n\t\t}\n\t\tconst getSymbol: string | undefined =\n\t\t\t!!inputValue && typeof this.selStart === 'number' ? inputValue[this.selStart] : '';\n\t\tlet newInputValue = '';\n\t\tif (this.hiddenInput && !this.writingValue) {\n\t\t\tlet actualResult: string[] = this.actualValue.split('');\n\t\t\t// eslint-disable  @typescript-eslint/no-unused-expressions\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\tinputValue !== '' && actualResult.length\n\t\t\t\t? typeof this.selStart === 'number' && typeof this.selEnd === 'number'\n\t\t\t\t\t? inputValue.length > actualResult.length\n\t\t\t\t\t\t? actualResult.splice(this.selStart, 0, getSymbol!)\n\t\t\t\t\t\t: inputValue.length < actualResult.length\n\t\t\t\t\t\t? actualResult.length - inputValue.length === 1\n\t\t\t\t\t\t\t? actualResult.splice(this.selStart - 1, 1)\n\t\t\t\t\t\t\t: actualResult.splice(this.selStart, this.selEnd - this.selStart)\n\t\t\t\t\t\t: null\n\t\t\t\t\t: null\n\t\t\t\t: (actualResult = []);\n\t\t\tif (this.showMaskTyped) {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tinputValue = this.removeMask(inputValue);\n\t\t\t}\n\t\t\t// eslint-enable  @typescript-eslint/no-unused-expressions\n\t\t\tnewInputValue =\n\t\t\t\tthis.actualValue.length && actualResult.length <= inputValue.length\n\t\t\t\t\t? this.shiftTypedSymbols(actualResult.join(''))\n\t\t\t\t\t: inputValue;\n\t\t}\n\t\tnewInputValue = Boolean(newInputValue) && newInputValue.length ? newInputValue : inputValue;\n\t\tconst result: string = super.applyMask(\n\t\t\tnewInputValue,\n\t\t\tmaskExpression,\n\t\t\tposition,\n\t\t\tjustPasted,\n\t\t\tbackspaced,\n\t\t\tcb,\n\t\t);\n\t\tthis.actualValue = this.getActualValue(result);\n\n\t\t// handle some separator implications:\n\t\t// a.) adjust decimalMarker default (. -> ,) if thousandSeparator is a dot\n\t\tif (this.thousandSeparator === '.' && this.decimalMarker === '.') {\n\t\t\tthis.decimalMarker = ',';\n\t\t}\n\n\t\t// b) remove decimal marker from list of special characters to mask\n\t\tif (this.maskExpression.startsWith('separator') && this.dropSpecialCharacters === true) {\n\t\t\tthis.maskSpecialCharacters = this.maskSpecialCharacters.filter(\n\t\t\t\t(item: string) => item !== this.decimalMarker,\n\t\t\t);\n\t\t}\n\n\t\tthis.formControlResult(result);\n\n\t\tif (!this.showMaskTyped) {\n\t\t\tif (this.hiddenInput) {\n\t\t\t\treturn result && result.length ? this.hideInput(result, this.maskExpression) : result;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst resLen: number = result.length;\n\t\tconst prefNmask: string = this.prefix + this.maskIsShown;\n\n\t\tif (this.maskExpression.includes('H')) {\n\t\t\tconst countSkipedSymbol = this._numberSkipedSymbols(result);\n\t\t\treturn result + prefNmask.slice(resLen + countSkipedSymbol);\n\t\t} else if (this.maskExpression === 'IP' || this.maskExpression === 'CPF_CNPJ') {\n\t\t\treturn result + prefNmask;\n\t\t}\n\t\treturn result + prefNmask.slice(resLen);\n\t}\n\n\t// get the number of characters that were shifted\n\tprivate _numberSkipedSymbols(value: string): number {\n\t\tconst regex = /(^|\\D)(\\d\\D)/g;\n\t\tlet match = regex.exec(value);\n\t\tlet countSkipedSymbol = 0;\n\t\twhile (match != null) {\n\t\t\tcountSkipedSymbol += 1;\n\t\t\tmatch = regex.exec(value);\n\t\t}\n\t\treturn countSkipedSymbol;\n\t}\n\n\tpublic applyValueChanges(\n\t\tposition: number = 0,\n\t\tjustPasted: boolean,\n\t\tbackspaced: boolean,\n\t\tcb: Function = () => {},\n\t): void {\n\t\tconst formElement = this._elementRef.nativeElement;\n\t\tformElement.value = this.applyMask(\n\t\t\tformElement.value,\n\t\t\tthis.maskExpression,\n\t\t\tposition,\n\t\t\tjustPasted,\n\t\t\tbackspaced,\n\t\t\tcb,\n\t\t);\n\t\tif (formElement === this.document.activeElement) {\n\t\t\treturn;\n\t\t}\n\t\tthis.clearIfNotMatchFn();\n\t}\n\n\tpublic hideInput(inputValue: string, maskExpression: string): string {\n\t\treturn inputValue\n\t\t\t.split('')\n\t\t\t.map((curr: string, index: number) => {\n\t\t\t\tif (\n\t\t\t\t\tthis.maskAvailablePatterns &&\n\t\t\t\t\tthis.maskAvailablePatterns[maskExpression[index]!] &&\n\t\t\t\t\tthis.maskAvailablePatterns[maskExpression[index]!]?.symbol\n\t\t\t\t) {\n\t\t\t\t\treturn this.maskAvailablePatterns[maskExpression[index]!]?.symbol;\n\t\t\t\t}\n\t\t\t\treturn curr;\n\t\t\t})\n\t\t\t.join('');\n\t}\n\n\t// this function is not necessary, it checks result against maskExpression\n\tpublic getActualValue(res: string): string {\n\t\tconst compare: string[] = res\n\t\t\t.split('')\n\t\t\t.filter(\n\t\t\t\t(symbol: string, i: number) =>\n\t\t\t\t\tthis._checkSymbolMask(symbol, this.maskExpression[i]!) ||\n\t\t\t\t\t(this.maskSpecialCharacters.includes(this.maskExpression[i]!) &&\n\t\t\t\t\t\tsymbol === this.maskExpression[i]),\n\t\t\t);\n\t\tif (compare.join('') === res) {\n\t\t\treturn compare.join('');\n\t\t}\n\t\treturn res;\n\t}\n\n\tpublic shiftTypedSymbols(inputValue: string): string {\n\t\tlet symbolToReplace = '';\n\t\tconst newInputValue: (string | undefined)[] =\n\t\t\t(inputValue &&\n\t\t\t\tinputValue.split('').map((currSymbol: string, index: number) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.maskSpecialCharacters.includes(inputValue[index + 1]!) &&\n\t\t\t\t\t\tinputValue[index + 1] !== this.maskExpression[index + 1]\n\t\t\t\t\t) {\n\t\t\t\t\t\tsymbolToReplace = currSymbol;\n\t\t\t\t\t\treturn inputValue[index + 1];\n\t\t\t\t\t}\n\t\t\t\t\tif (symbolToReplace.length) {\n\t\t\t\t\t\tconst replaceSymbol: string = symbolToReplace;\n\t\t\t\t\t\tsymbolToReplace = '';\n\t\t\t\t\t\treturn replaceSymbol;\n\t\t\t\t\t}\n\t\t\t\t\treturn currSymbol;\n\t\t\t\t})) ||\n\t\t\t[];\n\t\treturn newInputValue.join('');\n\t}\n\n\tpublic showMaskInInput(inputVal?: string): string {\n\t\tif (this.showMaskTyped && !!this.shownMaskExpression) {\n\t\t\tif (this.maskExpression.length !== this.shownMaskExpression.length) {\n\t\t\t\tthrow new Error('Mask expression must match mask placeholder length');\n\t\t\t} else {\n\t\t\t\treturn this.shownMaskExpression;\n\t\t\t}\n\t\t} else if (this.showMaskTyped) {\n\t\t\tif (inputVal) {\n\t\t\t\tif (this.maskExpression === 'IP') {\n\t\t\t\t\treturn this._checkForIp(inputVal);\n\t\t\t\t}\n\t\t\t\tif (this.maskExpression === 'CPF_CNPJ') {\n\t\t\t\t\treturn this._checkForCpfCnpj(inputVal);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.maskExpression.replace(/\\w/g, this.placeHolderCharacter);\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic clearIfNotMatchFn(): void {\n\t\tconst formElement = this._elementRef.nativeElement;\n\t\tif (\n\t\t\tthis.clearIfNotMatch &&\n\t\t\tthis.prefix.length + this.maskExpression.length + this.suffix.length !==\n\t\t\t\tformElement.value.replace(/_/g, '').length\n\t\t) {\n\t\t\tthis.formElementProperty = ['value', ''];\n\t\t\tthis.applyMask(formElement.value, this.maskExpression);\n\t\t}\n\t}\n\n\tpublic set formElementProperty([name, value]: [string, string | boolean]) {\n\t\tPromise.resolve().then(() =>\n\t\t\tthis._renderer.setProperty(this._elementRef.nativeElement, name, value),\n\t\t);\n\t}\n\n\tpublic checkSpecialCharAmount(mask: string): number {\n\t\tconst chars: string[] = mask.split('').filter((item: string) => this._findSpecialChar(item));\n\t\treturn chars.length;\n\t}\n\n\tpublic removeMask(inputValue: string): string {\n\t\treturn this._removeMask(\n\t\t\tthis._removeSuffix(this._removePrefix(inputValue)),\n\t\t\tthis.maskSpecialCharacters.concat('_').concat(this.placeHolderCharacter),\n\t\t);\n\t}\n\n\tprivate _checkForIp(inputVal: string): string {\n\t\tif (inputVal === '#') {\n\t\t\treturn `${this.placeHolderCharacter}.${this.placeHolderCharacter}.${this.placeHolderCharacter}.${this.placeHolderCharacter}`;\n\t\t}\n\t\tconst arr: string[] = [];\n\t\tfor (let i = 0; i < inputVal.length; i++) {\n\t\t\tif (inputVal[i]?.match('\\\\d')) {\n\t\t\t\tarr.push(inputVal[i]!);\n\t\t\t}\n\t\t}\n\t\tif (arr.length <= 3) {\n\t\t\treturn `${this.placeHolderCharacter}.${this.placeHolderCharacter}.${this.placeHolderCharacter}`;\n\t\t}\n\t\tif (arr.length > 3 && arr.length <= 6) {\n\t\t\treturn `${this.placeHolderCharacter}.${this.placeHolderCharacter}`;\n\t\t}\n\t\tif (arr.length > 6 && arr.length <= 9) {\n\t\t\treturn this.placeHolderCharacter;\n\t\t}\n\t\tif (arr.length > 9 && arr.length <= 12) {\n\t\t\treturn '';\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate _checkForCpfCnpj(inputVal: string): string {\n\t\tconst cpf =\n\t\t\t`${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`.${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`.${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`-${this.placeHolderCharacter}${this.placeHolderCharacter}`;\n\t\tconst cnpj =\n\t\t\t`${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`.${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`.${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`/${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}${this.placeHolderCharacter}` +\n\t\t\t`-${this.placeHolderCharacter}${this.placeHolderCharacter}`;\n\n\t\tif (inputVal === '#') {\n\t\t\treturn cpf;\n\t\t}\n\t\tconst arr: string[] = [];\n\t\tfor (let i = 0; i < inputVal.length; i++) {\n\t\t\tif (inputVal[i]?.match('\\\\d')) {\n\t\t\t\tarr.push(inputVal[i]!);\n\t\t\t}\n\t\t}\n\t\tif (arr.length <= 3) {\n\t\t\treturn cpf.slice(arr.length, cpf.length);\n\t\t}\n\t\tif (arr.length > 3 && arr.length <= 6) {\n\t\t\treturn cpf.slice(arr.length + 1, cpf.length);\n\t\t}\n\t\tif (arr.length > 6 && arr.length <= 9) {\n\t\t\treturn cpf.slice(arr.length + 2, cpf.length);\n\t\t}\n\t\tif (arr.length > 9 && arr.length < 11) {\n\t\t\treturn cpf.slice(arr.length + 3, cpf.length);\n\t\t}\n\t\tif (arr.length === 11) {\n\t\t\treturn '';\n\t\t}\n\t\tif (arr.length === 12) {\n\t\t\tif (inputVal.length === 17) {\n\t\t\t\treturn cnpj.slice(16, cnpj.length);\n\t\t\t}\n\t\t\treturn cnpj.slice(15, cnpj.length);\n\t\t}\n\t\tif (arr.length > 12 && arr.length <= 14) {\n\t\t\treturn cnpj.slice(arr.length + 4, cnpj.length);\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * Propogates the input value back to the Angular model by triggering the onChange function. It won't do this if writingValue\n\t * is true. If that is true it means we are currently in the writeValue function, which is supposed to only update the actual\n\t * DOM element based on the Angular model value. It should be a one way process, i.e. writeValue should not be modifying the Angular\n\t * model value too. Therefore, we don't trigger onChange in this scenario.\n\t * @param inputValue the current form input value\n\t */\n\tprivate formControlResult(inputValue: string): void {\n\t\tif (this.writingValue || this.maskChanged) {\n\t\t\tthis.maskChanged = false;\n\t\t\treturn;\n\t\t}\n\t\tif (Array.isArray(this.dropSpecialCharacters)) {\n\t\t\tthis.onChange(\n\t\t\t\tthis._toNumber(\n\t\t\t\t\tthis._removeMask(\n\t\t\t\t\t\tthis._removeSuffix(this._removePrefix(inputValue)),\n\t\t\t\t\t\tthis.dropSpecialCharacters,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\t\t} else if (this.dropSpecialCharacters) {\n\t\t\tthis.onChange(this._toNumber(this._checkSymbols(inputValue)));\n\t\t} else {\n\t\t\tthis.onChange(this._removeSuffix(inputValue));\n\t\t}\n\t}\n\n\tprivate _toNumber(value: string | number | undefined | null) {\n\t\tif (!this.isNumberValue || value === '') {\n\t\t\treturn value;\n\t\t}\n\t\tconst num = Number(value);\n\t\treturn Number.isNaN(num) ? value : num;\n\t}\n\n\tprivate _removeMask(value: string, specialCharactersForRemove: string[]): string {\n\t\treturn value ? value.replace(this._regExpForRemove(specialCharactersForRemove), '') : value;\n\t}\n\n\tprivate _removePrefix(value: string): string {\n\t\tif (!this.prefix) {\n\t\t\treturn value;\n\t\t}\n\t\treturn value ? value.replace(this.prefix, '') : value;\n\t}\n\n\tprivate _removeSuffix(value: string): string {\n\t\tif (!this.suffix) {\n\t\t\treturn value;\n\t\t}\n\t\treturn value ? value.replace(this.suffix, '') : value;\n\t}\n\n\tprivate _retrieveSeparatorValue(result: string): string {\n\t\treturn this._removeMask(\n\t\t\tthis._removeSuffix(this._removePrefix(result)),\n\t\t\tthis.maskSpecialCharacters,\n\t\t);\n\t}\n\n\tprivate _regExpForRemove(specialCharactersForRemove: string[]): RegExp {\n\t\treturn new RegExp(\n\t\t\tspecialCharactersForRemove.map((item: string) => `\\\\${item}`).join('|'),\n\t\t\t'gi',\n\t\t);\n\t}\n\n\tprivate _checkSymbols(result: string): string | number | undefined | null {\n\t\tif (result === '') {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst separatorPrecision: number | null = this._retrieveSeparatorPrecision(this.maskExpression);\n\t\tlet separatorValue: string = this._retrieveSeparatorValue(result);\n\t\tif (this.decimalMarker !== '.') {\n\t\t\tseparatorValue = separatorValue.replace(this.decimalMarker, '.');\n\t\t}\n\n\t\tif (!this.isNumberValue) {\n\t\t\treturn separatorValue;\n\t\t}\n\t\tif (separatorPrecision) {\n\t\t\tif (result === this.decimalMarker) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn this._checkPrecision(this.maskExpression, separatorValue);\n\t\t} else {\n\t\t\treturn Number(separatorValue);\n\t\t}\n\t}\n\n\t// TODO should think about helpers or separting decimal precision to own property\n\tprivate _retrieveSeparatorPrecision(maskExpretion: string): number | null {\n\t\tconst matcher: RegExpMatchArray | null = maskExpretion.match(\n\t\t\tnew RegExp(`^separator\\\\.([^d]*)`),\n\t\t);\n\t\treturn matcher ? Number(matcher[1]) : null;\n\t}\n\n\tprivate _checkPrecision(separatorExpression: string, separatorValue: string): number | string {\n\t\tif (separatorExpression.indexOf('2') > 0) {\n\t\t\treturn Number(separatorValue).toFixed(2);\n\t\t}\n\t\treturn Number(separatorValue);\n\t}\n}\n","import {\n\tControlValueAccessor,\n\tFormControl,\n\tNG_VALIDATORS,\n\tNG_VALUE_ACCESSOR,\n\tValidationErrors,\n\tValidator,\n} from '@angular/forms';\nimport {\n\tDirective,\n\tforwardRef,\n\tHostListener,\n\tInject,\n\tInput,\n\tOnChanges,\n\tSimpleChanges,\n} from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\n\nimport { CustomKeyboardEvent } from './custom-keyboard-event';\nimport { config, IConfig, timeMasks, withoutValidation } from './config';\nimport { MaskService } from './mask.service';\n\n@Directive({\n\tselector: 'input[mask], textarea[mask]',\n\tproviders: [\n\t\t{\n\t\t\tprovide: NG_VALUE_ACCESSOR,\n\t\t\tuseExisting: forwardRef(() => MaskDirective),\n\t\t\tmulti: true,\n\t\t},\n\t\t{\n\t\t\tprovide: NG_VALIDATORS,\n\t\t\tuseExisting: forwardRef(() => MaskDirective),\n\t\t\tmulti: true,\n\t\t},\n\t\tMaskService,\n\t],\n})\nexport class MaskDirective implements ControlValueAccessor, OnChanges, Validator {\n\t// eslint-disable-next-line @angular-eslint/no-input-rename\n\t@Input('mask') public maskExpression: string = '';\n\n\t@Input() public specialCharacters: IConfig['specialCharacters'] = [];\n\n\t@Input() public patterns: IConfig['patterns'] = {};\n\n\t@Input() public prefix: IConfig['prefix'] = '';\n\n\t@Input() public suffix: IConfig['suffix'] = '';\n\n\t@Input() public thousandSeparator: IConfig['thousandSeparator'] = ' ';\n\n\t@Input() public decimalMarker: IConfig['decimalMarker'] = '.';\n\n\t@Input() public dropSpecialCharacters: IConfig['dropSpecialCharacters'] | null = null;\n\n\t@Input() public hiddenInput: IConfig['hiddenInput'] | null = null;\n\n\t@Input() public showMaskTyped: IConfig['showMaskTyped'] | null = null;\n\n\t@Input() public placeHolderCharacter: IConfig['placeHolderCharacter'] | null = null;\n\n\t@Input() public shownMaskExpression: IConfig['shownMaskExpression'] | null = null;\n\n\t@Input() public showTemplate: IConfig['showTemplate'] | null = null;\n\n\t@Input() public clearIfNotMatch: IConfig['clearIfNotMatch'] | null = null;\n\n\t@Input() public validation: IConfig['validation'] | null = null;\n\n\t@Input() public separatorLimit: IConfig['separatorLimit'] | null = null;\n\n\t@Input() public allowNegativeNumbers: IConfig['allowNegativeNumbers'] | null = null;\n\n\t@Input() public leadZeroDateTime: IConfig['leadZeroDateTime'] | null = null;\n\n\tprivate _maskValue: string = '';\n\n\tprivate _inputValue!: string;\n\n\tprivate _position: number | null = null;\n\n\tprivate _start!: number;\n\n\tprivate _end!: number;\n\n\tprivate _code!: string;\n\n\tprivate _maskExpressionArray: string[] = [];\n\n\tprivate _justPasted: boolean = false;\n\n\tpublic constructor(\n\t\t@Inject(DOCUMENT) private document: any,\n\t\tpublic _maskService: MaskService,\n\t\t@Inject(config) protected _config: IConfig,\n\t) {}\n\n\tpublic onChange = (_: any) => {};\n\n\tpublic onTouch = () => {};\n\n\tpublic ngOnChanges(changes: SimpleChanges): void {\n\t\tconst {\n\t\t\tmaskExpression,\n\t\t\tspecialCharacters,\n\t\t\tpatterns,\n\t\t\tprefix,\n\t\t\tsuffix,\n\t\t\tthousandSeparator,\n\t\t\tdecimalMarker,\n\t\t\tdropSpecialCharacters,\n\t\t\thiddenInput,\n\t\t\tshowMaskTyped,\n\t\t\tplaceHolderCharacter,\n\t\t\tshownMaskExpression,\n\t\t\tshowTemplate,\n\t\t\tclearIfNotMatch,\n\t\t\tvalidation,\n\t\t\tseparatorLimit,\n\t\t\tallowNegativeNumbers,\n\t\t\tleadZeroDateTime,\n\t\t} = changes;\n\t\tif (maskExpression) {\n\t\t\tif (\n\t\t\t\tmaskExpression.currentValue !== maskExpression.previousValue &&\n\t\t\t\t!maskExpression.firstChange\n\t\t\t) {\n\t\t\t\tthis._maskService.maskChanged = true;\n\t\t\t}\n\t\t\tthis._maskValue = maskExpression.currentValue || '';\n\t\t\tif (maskExpression.currentValue && maskExpression.currentValue.split('||').length > 1) {\n\t\t\t\tthis._maskExpressionArray = maskExpression.currentValue\n\t\t\t\t\t.split('||')\n\t\t\t\t\t.sort((a: string, b: string) => {\n\t\t\t\t\t\treturn a.length - b.length;\n\t\t\t\t\t});\n\t\t\t\tthis._maskValue = this._maskExpressionArray[0]!;\n\t\t\t\tthis.maskExpression = this._maskExpressionArray[0]!;\n\t\t\t\tthis._maskService.maskExpression = this._maskExpressionArray[0]!;\n\t\t\t}\n\t\t}\n\t\tif (specialCharacters) {\n\t\t\tif (!specialCharacters.currentValue || !Array.isArray(specialCharacters.currentValue)) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis._maskService.maskSpecialCharacters = specialCharacters.currentValue || [];\n\t\t\t}\n\t\t}\n\t\t// Only overwrite the mask available patterns if a pattern has actually been passed in\n\t\tif (patterns && patterns.currentValue) {\n\t\t\tthis._maskService.maskAvailablePatterns = patterns.currentValue;\n\t\t}\n\t\tif (prefix) {\n\t\t\tthis._maskService.prefix = prefix.currentValue;\n\t\t}\n\t\tif (suffix) {\n\t\t\tthis._maskService.suffix = suffix.currentValue;\n\t\t}\n\t\tif (thousandSeparator) {\n\t\t\tthis._maskService.thousandSeparator = thousandSeparator.currentValue;\n\t\t}\n\t\tif (decimalMarker) {\n\t\t\tthis._maskService.decimalMarker = decimalMarker.currentValue;\n\t\t}\n\t\tif (dropSpecialCharacters) {\n\t\t\tthis._maskService.dropSpecialCharacters = dropSpecialCharacters.currentValue;\n\t\t}\n\t\tif (hiddenInput) {\n\t\t\tthis._maskService.hiddenInput = hiddenInput.currentValue;\n\t\t}\n\t\tif (showMaskTyped) {\n\t\t\tthis._maskService.showMaskTyped = showMaskTyped.currentValue;\n\t\t}\n\t\tif (placeHolderCharacter) {\n\t\t\tthis._maskService.placeHolderCharacter = placeHolderCharacter.currentValue;\n\t\t}\n\t\tif (shownMaskExpression) {\n\t\t\tthis._maskService.shownMaskExpression = shownMaskExpression.currentValue;\n\t\t}\n\t\tif (showTemplate) {\n\t\t\tthis._maskService.showTemplate = showTemplate.currentValue;\n\t\t}\n\t\tif (clearIfNotMatch) {\n\t\t\tthis._maskService.clearIfNotMatch = clearIfNotMatch.currentValue;\n\t\t}\n\t\tif (validation) {\n\t\t\tthis._maskService.validation = validation.currentValue;\n\t\t}\n\t\tif (separatorLimit) {\n\t\t\tthis._maskService.separatorLimit = separatorLimit.currentValue;\n\t\t}\n\t\tif (allowNegativeNumbers) {\n\t\t\tthis._maskService.allowNegativeNumbers = allowNegativeNumbers.currentValue;\n\t\t\tif (this._maskService.allowNegativeNumbers) {\n\t\t\t\tthis._maskService.maskSpecialCharacters = this._maskService.maskSpecialCharacters.filter(\n\t\t\t\t\t(c: string) => c !== '-',\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif (leadZeroDateTime) {\n\t\t\tthis._maskService.leadZeroDateTime = leadZeroDateTime.currentValue;\n\t\t}\n\t\tthis._applyMask();\n\t}\n\n\t// eslint-disable-next-line complexity\n\tpublic validate({ value }: FormControl): ValidationErrors | null {\n\t\tif (!this._maskService.validation || !this._maskValue) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._maskService.ipError) {\n\t\t\treturn this._createValidationError(value);\n\t\t}\n\t\tif (this._maskService.cpfCnpjError) {\n\t\t\treturn this._createValidationError(value);\n\t\t}\n\t\tif (this._maskValue.startsWith('separator')) {\n\t\t\treturn null;\n\t\t}\n\t\tif (withoutValidation.includes(this._maskValue)) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._maskService.clearIfNotMatch) {\n\t\t\treturn null;\n\t\t}\n\t\tif (timeMasks.includes(this._maskValue)) {\n\t\t\treturn this._validateTime(value);\n\t\t}\n\t\tif (value && value.toString().length >= 1) {\n\t\t\tlet counterOfOpt = 0;\n\t\t\tfor (const key in this._maskService.maskAvailablePatterns) {\n\t\t\t\tif (this._maskService.maskAvailablePatterns[key]!.optional) {\n\t\t\t\t\tif (this._maskValue.indexOf(key) !== this._maskValue.lastIndexOf(key)) {\n\t\t\t\t\t\tconst opt: string = this._maskValue\n\t\t\t\t\t\t\t.split('')\n\t\t\t\t\t\t\t.filter((i: string) => i === key)\n\t\t\t\t\t\t\t.join('');\n\t\t\t\t\t\tcounterOfOpt += opt.length;\n\t\t\t\t\t} else if (this._maskValue.indexOf(key) !== -1) {\n\t\t\t\t\t\tcounterOfOpt++;\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis._maskValue.indexOf(key) !== -1 &&\n\t\t\t\t\t\tvalue.toString().length >= this._maskValue.indexOf(key)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tif (counterOfOpt === this._maskValue.length) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (\n\t\t\t\tthis._maskValue.indexOf('{') === 1 &&\n\t\t\t\tvalue.toString().length ===\n\t\t\t\t\tthis._maskValue.length + Number(this._maskValue.split('{')[1]!.split('}')[0]) - 4\n\t\t\t) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tif (this._maskValue.indexOf('*') === 1 || this._maskValue.indexOf('?') === 1) {\n\t\t\t\treturn null;\n\t\t\t} else if (\n\t\t\t\t(this._maskValue.indexOf('*') > 1 &&\n\t\t\t\t\tvalue.toString().length < this._maskValue.indexOf('*')) ||\n\t\t\t\t(this._maskValue.indexOf('?') > 1 &&\n\t\t\t\t\tvalue.toString().length < this._maskValue.indexOf('?')) ||\n\t\t\t\tthis._maskValue.indexOf('{') === 1\n\t\t\t) {\n\t\t\t\treturn this._createValidationError(value);\n\t\t\t}\n\t\t\tif (this._maskValue.indexOf('*') === -1 || this._maskValue.indexOf('?') === -1) {\n\t\t\t\tconst length: number = this._maskService.dropSpecialCharacters\n\t\t\t\t\t? this._maskValue.length -\n\t\t\t\t\t  this._maskService.checkSpecialCharAmount(this._maskValue) -\n\t\t\t\t\t  counterOfOpt\n\t\t\t\t\t: this._maskValue.length - counterOfOpt;\n\t\t\t\tif (value.toString().length < length) {\n\t\t\t\t\treturn this._createValidationError(value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t@HostListener('paste')\n\tpublic onPaste() {\n\t\tthis._justPasted = true;\n\t}\n\n\t@HostListener('ngModelChange', ['$event'])\n\tpublic onModelChange(value: any): void {\n\t\t// on form reset we need to update the actualValue\n\t\tif (!value && this._maskService.actualValue) {\n\t\t\tthis._maskService.actualValue = this._maskService.getActualValue('');\n\t\t}\n\t}\n\n\t@HostListener('input', ['$event'])\n\tpublic onInput(e: CustomKeyboardEvent): void {\n\t\tconst el: HTMLInputElement = e.target as HTMLInputElement;\n\t\tthis._inputValue = el.value;\n\n\t\tthis._setMask();\n\n\t\tif (!this._maskValue) {\n\t\t\tthis.onChange(el.value);\n\t\t\treturn;\n\t\t}\n\t\tconst position: number =\n\t\t\tel.selectionStart === 1\n\t\t\t\t? (el.selectionStart as number) + this._maskService.prefix.length\n\t\t\t\t: (el.selectionStart as number);\n\t\tlet caretShift = 0;\n\t\tlet backspaceShift = false;\n\t\tthis._maskService.applyValueChanges(\n\t\t\tposition,\n\t\t\tthis._justPasted,\n\t\t\tthis._code === 'Backspace' || this._code === 'Delete',\n\t\t\t(shift: number, _backspaceShift: boolean) => {\n\t\t\t\tthis._justPasted = false;\n\t\t\t\tcaretShift = shift;\n\t\t\t\tbackspaceShift = _backspaceShift;\n\t\t\t},\n\t\t);\n\t\t// only set the selection if the element is active\n\t\tif (this.document.activeElement !== el) {\n\t\t\treturn;\n\t\t}\n\t\tthis._position = this._position === 1 && this._inputValue.length === 1 ? null : this._position;\n\t\tlet positionToApply: number = this._position\n\t\t\t? this._inputValue.length + position + caretShift\n\t\t\t: position + (this._code === 'Backspace' && !backspaceShift ? 0 : caretShift);\n\t\tif (positionToApply > this._getActualInputLength()) {\n\t\t\tpositionToApply = this._getActualInputLength();\n\t\t}\n\t\tif (positionToApply < 0) {\n\t\t\tpositionToApply = 0;\n\t\t}\n\t\tel.setSelectionRange(positionToApply, positionToApply);\n\t\tthis._position = null;\n\t}\n\n\t@HostListener('blur')\n\tpublic onBlur(): void {\n\t\tif (this._maskValue) {\n\t\t\tthis._maskService.clearIfNotMatchFn();\n\t\t}\n\t\tthis.onTouch();\n\t}\n\n\t@HostListener('click', ['$event'])\n\tpublic onFocus(e: MouseEvent | CustomKeyboardEvent): void {\n\t\tif (!this._maskValue) {\n\t\t\treturn;\n\t\t}\n\t\tconst el: HTMLInputElement = e.target as HTMLInputElement;\n\t\tconst posStart = 0;\n\t\tconst posEnd = 0;\n\t\tif (\n\t\t\tel !== null &&\n\t\t\tel.selectionStart !== null &&\n\t\t\tel.selectionStart === el.selectionEnd &&\n\t\t\tel.selectionStart > this._maskService.prefix.length &&\n\t\t\t// eslint-disable-next-line\n\t\t\t(e as any).keyCode !== 38\n\t\t) {\n\t\t\tif (this._maskService.showMaskTyped) {\n\t\t\t\t// We are showing the mask in the input\n\t\t\t\tthis._maskService.maskIsShown = this._maskService.showMaskInInput();\n\t\t\t\tif (\n\t\t\t\t\tel.setSelectionRange &&\n\t\t\t\t\tthis._maskService.prefix + this._maskService.maskIsShown === el.value\n\t\t\t\t) {\n\t\t\t\t\t// the input ONLY contains the mask, so position the cursor at the start\n\t\t\t\t\tel.focus();\n\t\t\t\t\tel.setSelectionRange(posStart, posEnd);\n\t\t\t\t} else {\n\t\t\t\t\t// the input contains some characters already\n\t\t\t\t\tif (el.selectionStart > this._maskService.actualValue.length) {\n\t\t\t\t\t\t// if the user clicked beyond our value's length, position the cursor at the end of our value\n\t\t\t\t\t\tel.setSelectionRange(\n\t\t\t\t\t\t\tthis._maskService.actualValue.length,\n\t\t\t\t\t\t\tthis._maskService.actualValue.length,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst nextValue: string | null =\n\t\t\t!el.value || el.value === this._maskService.prefix\n\t\t\t\t? this._maskService.prefix + this._maskService.maskIsShown\n\t\t\t\t: el.value;\n\n\t\t/** Fix of cursor position jumping to end in most browsers no matter where cursor is inserted onFocus */\n\t\tif (el.value !== nextValue) {\n\t\t\tel.value = nextValue;\n\t\t}\n\n\t\t/** fix of cursor position with prefix when mouse click occur */\n\t\tif (\n\t\t\t((el.selectionStart as number) || (el.selectionEnd as number)) <=\n\t\t\tthis._maskService.prefix.length\n\t\t) {\n\t\t\tel.selectionStart = this._maskService.prefix.length;\n\t\t\treturn;\n\t\t}\n\n\t\t/** select only inserted text */\n\t\tif ((el.selectionEnd as number) > this._getActualInputLength()) {\n\t\t\tel.selectionEnd = this._getActualInputLength();\n\t\t}\n\t}\n\n\t// eslint-disable-next-line complexity\n\t@HostListener('keydown', ['$event'])\n\tpublic onKeyDown(e: CustomKeyboardEvent): void {\n\t\tif (!this._maskValue) {\n\t\t\treturn;\n\t\t}\n\t\tthis._code = e.code ? e.code : e.key;\n\t\tconst el: HTMLInputElement = e.target as HTMLInputElement;\n\t\tthis._inputValue = el.value;\n\n\t\tthis._setMask();\n\n\t\tif (e.keyCode === 38) {\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (e.keyCode === 37 || e.keyCode === 8 || e.keyCode === 46) {\n\t\t\tif (e.keyCode === 8 && el.value.length === 0) {\n\t\t\t\tel.selectionStart = el.selectionEnd;\n\t\t\t}\n\t\t\tif (e.keyCode === 8 && (el.selectionStart as number) !== 0) {\n\t\t\t\t// If specialChars is false, (shouldn't ever happen) then set to the defaults\n\t\t\t\tthis.specialCharacters = this.specialCharacters?.length\n\t\t\t\t\t? this.specialCharacters\n\t\t\t\t\t: this._config.specialCharacters;\n\t\t\t\tif (this.prefix.length > 1 && (el.selectionStart as number) <= this.prefix.length) {\n\t\t\t\t\tel.setSelectionRange(this.prefix.length, this.prefix.length);\n\t\t\t\t} else {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis._inputValue.length !== (el.selectionStart as number) &&\n\t\t\t\t\t\t(el.selectionStart as number) !== 1\n\t\t\t\t\t) {\n\t\t\t\t\t\twhile (\n\t\t\t\t\t\t\tthis.specialCharacters.includes(\n\t\t\t\t\t\t\t\tthis._inputValue[(el.selectionStart as number) - 1]!.toString(),\n\t\t\t\t\t\t\t) &&\n\t\t\t\t\t\t\t((this.prefix.length >= 1 && (el.selectionStart as number) > this.prefix.length) ||\n\t\t\t\t\t\t\t\tthis.prefix.length === 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tel.setSelectionRange(\n\t\t\t\t\t\t\t\t(el.selectionStart as number) - 1,\n\t\t\t\t\t\t\t\t(el.selectionStart as number) - 1,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.suffixCheckOnPressDelete(e.keyCode, el);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.suffixCheckOnPressDelete(e.keyCode, el);\n\t\t\tif (\n\t\t\t\tthis._maskService.prefix.length &&\n\t\t\t\t(el.selectionStart as number) <= this._maskService.prefix.length &&\n\t\t\t\t(el.selectionEnd as number) <= this._maskService.prefix.length\n\t\t\t) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t\tconst cursorStart: number | null = el.selectionStart;\n\t\t\tif (\n\t\t\t\te.keyCode === 8 &&\n\t\t\t\t!el.readOnly &&\n\t\t\t\tcursorStart === 0 &&\n\t\t\t\tel.selectionEnd === el.value.length &&\n\t\t\t\tel.value.length !== 0\n\t\t\t) {\n\t\t\t\tthis._position = this._maskService.prefix ? this._maskService.prefix.length : 0;\n\t\t\t\tthis._maskService.applyMask(\n\t\t\t\t\tthis._maskService.prefix,\n\t\t\t\t\tthis._maskService.maskExpression,\n\t\t\t\t\tthis._position,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\t!!this.suffix &&\n\t\t\tthis.suffix.length > 1 &&\n\t\t\tthis._inputValue.length - this.suffix.length < (el.selectionStart as number)\n\t\t) {\n\t\t\tel.setSelectionRange(this._inputValue.length - this.suffix.length, this._inputValue.length);\n\t\t} else if (\n\t\t\t(e.keyCode === 65 && e.ctrlKey) ||\n\t\t\t(e.keyCode === 65 && e.metaKey) // Cmd + A (Mac)\n\t\t) {\n\t\t\tel.setSelectionRange(0, this._getActualInputLength());\n\t\t\te.preventDefault();\n\t\t}\n\t\tthis._maskService.selStart = el.selectionStart;\n\t\tthis._maskService.selEnd = el.selectionEnd;\n\t}\n\n\t/** It writes the value in the input */\n\tpublic async writeValue(\n\t\tinputValue: string | number | { value: string | number; disable?: boolean },\n\t): Promise<void> {\n\t\tif (typeof inputValue === 'object' && inputValue !== null && 'value' in inputValue) {\n\t\t\tif ('disable' in inputValue) {\n\t\t\t\tthis.setDisabledState(Boolean(inputValue.disable));\n\t\t\t}\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue = inputValue.value;\n\t\t}\n\n\t\tif (typeof inputValue === 'number') {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue = String(inputValue);\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue =\n\t\t\t\tthis.decimalMarker !== '.' ? inputValue.replace('.', this.decimalMarker) : inputValue;\n\t\t\tthis._maskService.isNumberValue = true;\n\t\t}\n\n\t\tif (typeof inputValue !== 'string') {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinputValue = '';\n\t\t}\n\n\t\tthis._inputValue = inputValue;\n\t\tthis._setMask();\n\n\t\tif (\n\t\t\t(inputValue && this._maskService.maskExpression) ||\n\t\t\t(this._maskService.maskExpression &&\n\t\t\t\t(this._maskService.prefix || this._maskService.showMaskTyped))\n\t\t) {\n\t\t\t// Let the service we know we are writing value so that triggering onChange function wont happen during applyMask\n\t\t\tthis._maskService.writingValue = true;\n\t\t\tthis._maskService.formElementProperty = [\n\t\t\t\t'value',\n\t\t\t\tthis._maskService.applyMask(inputValue, this._maskService.maskExpression),\n\t\t\t];\n\t\t\t// Let the service know we've finished writing value\n\t\t\tthis._maskService.writingValue = false;\n\t\t} else {\n\t\t\tthis._maskService.formElementProperty = ['value', inputValue];\n\t\t}\n\t\tthis._inputValue = inputValue;\n\t}\n\n\tpublic registerOnChange(fn: any): void {\n\t\tthis.onChange = fn;\n\t\tthis._maskService.onChange = this.onChange;\n\t}\n\n\tpublic registerOnTouched(fn: any): void {\n\t\tthis.onTouch = fn;\n\t}\n\n\tpublic suffixCheckOnPressDelete(keyCode: number, el: HTMLInputElement): void {\n\t\tif (keyCode === 46 && this.suffix.length > 0) {\n\t\t\tif (this._inputValue.length - this.suffix.length <= (el.selectionStart as number)) {\n\t\t\t\tel.setSelectionRange(this._inputValue.length - this.suffix.length, this._inputValue.length);\n\t\t\t}\n\t\t}\n\t\tif (keyCode === 8) {\n\t\t\tif (\n\t\t\t\tthis.suffix.length > 1 &&\n\t\t\t\tthis._inputValue.length - this.suffix.length < (el.selectionStart as number)\n\t\t\t) {\n\t\t\t\tel.setSelectionRange(this._inputValue.length - this.suffix.length, this._inputValue.length);\n\t\t\t}\n\t\t\tif (this.suffix.length === 1 && this._inputValue.length === (el.selectionStart as number)) {\n\t\t\t\tel.setSelectionRange((el.selectionStart as number) - 1, (el.selectionStart as number) - 1);\n\t\t\t}\n\t\t}\n\t}\n\n\t/** It disables the input element */\n\tpublic setDisabledState(isDisabled: boolean): void {\n\t\tthis._maskService.formElementProperty = ['disabled', isDisabled];\n\t}\n\n\tprivate _repeatPatternSymbols(maskExp: string): string {\n\t\treturn (\n\t\t\t(maskExp.match(/{[0-9]+}/) &&\n\t\t\t\tmaskExp.split('').reduce((accum: string, currval: string, index: number): string => {\n\t\t\t\t\tthis._start = currval === '{' ? index : this._start;\n\n\t\t\t\t\tif (currval !== '}') {\n\t\t\t\t\t\treturn this._maskService._findSpecialChar(currval) ? accum + currval : accum;\n\t\t\t\t\t}\n\t\t\t\t\tthis._end = index;\n\t\t\t\t\tconst repeatNumber: number = Number(maskExp.slice(this._start + 1, this._end));\n\t\t\t\t\tconst replaceWith: string = new Array(repeatNumber + 1).join(maskExp[this._start - 1]);\n\t\t\t\t\treturn accum + replaceWith;\n\t\t\t\t}, '')) ||\n\t\t\tmaskExp\n\t\t);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tprivate _applyMask(): any {\n\t\tthis._maskService.maskExpression = this._repeatPatternSymbols(this._maskValue || '');\n\t\tthis._maskService.formElementProperty = [\n\t\t\t'value',\n\t\t\tthis._maskService.applyMask(this._inputValue, this._maskService.maskExpression),\n\t\t];\n\t}\n\n\tprivate _validateTime(value: string): ValidationErrors | null {\n\t\tconst rowMaskLen: number = this._maskValue.split('').filter((s: string) => s !== ':').length;\n\t\tif (!value) {\n\t\t\treturn null; // Don't validate empty values to allow for optional form control\n\t\t}\n\n\t\tif (\n\t\t\t(+value[value.length - 1]! === 0 && value.length < rowMaskLen) ||\n\t\t\tvalue.length <= rowMaskLen - 2\n\t\t) {\n\t\t\treturn this._createValidationError(value);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _getActualInputLength() {\n\t\treturn (\n\t\t\tthis._maskService.actualValue.length ||\n\t\t\tthis._maskService.actualValue.length + this._maskService.prefix.length\n\t\t);\n\t}\n\n\tprivate _createValidationError(actualValue: string): ValidationErrors {\n\t\treturn {\n\t\t\tmask: {\n\t\t\t\trequiredMask: this._maskValue,\n\t\t\t\tactualValue,\n\t\t\t},\n\t\t};\n\t}\n\n\tprivate _setMask() {\n\t\tif (this._maskExpressionArray.length > 0) {\n\t\t\tthis._maskExpressionArray.some((mask): boolean | void => {\n\t\t\t\tconst test =\n\t\t\t\t\tthis._maskService.removeMask(this._inputValue)?.length <=\n\t\t\t\t\tthis._maskService.removeMask(mask)?.length;\n\t\t\t\tif (this._inputValue && test) {\n\t\t\t\t\tthis._maskValue = mask;\n\t\t\t\t\tthis.maskExpression = mask;\n\t\t\t\t\tthis._maskService.maskExpression = mask;\n\t\t\t\t\treturn test;\n\t\t\t\t} else {\n\t\t\t\t\tthis._maskValue = this._maskExpressionArray[this._maskExpressionArray.length - 1]!;\n\t\t\t\t\tthis.maskExpression = this._maskExpressionArray[this._maskExpressionArray.length - 1]!;\n\t\t\t\t\tthis._maskService.maskExpression =\n\t\t\t\t\t\tthis._maskExpressionArray[this._maskExpressionArray.length - 1]!;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MaskApplierService } from './mask-applier.service';\nimport { IConfig } from './config';\n\n@Pipe({\n\tname: 'mask',\n\tpure: true,\n})\nexport class MaskPipe implements PipeTransform {\n\tpublic constructor(private _maskService: MaskApplierService) {}\n\n\tpublic transform(\n\t\tvalue: string | number,\n\t\tmask: string | [string, IConfig['patterns']],\n\t\tthousandSeparator: string | null = null,\n\t): string {\n\t\tif (!value && typeof value !== 'number') {\n\t\t\treturn '';\n\t\t}\n\t\tif (thousandSeparator) {\n\t\t\tthis._maskService.thousandSeparator = thousandSeparator;\n\t\t}\n\t\tif (typeof mask === 'string') {\n\t\t\treturn this._maskService.applyMask(`${value}`, mask);\n\t\t}\n\t\treturn this._maskService.applyMaskWithPattern(`${value}`, mask);\n\t}\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { config, INITIAL_CONFIG, initialConfig, NEW_CONFIG, optionsConfig } from './config';\nimport { MaskApplierService } from './mask-applier.service';\nimport { MaskDirective } from './mask.directive';\nimport { MaskPipe } from './mask.pipe';\n/**\n * @internal\n */\nexport function _configFactory(\n\tinitConfig: optionsConfig,\n\tconfigValue: optionsConfig | (() => optionsConfig),\n): optionsConfig {\n\treturn configValue instanceof Function\n\t\t? { ...initConfig, ...configValue() }\n\t\t: { ...initConfig, ...configValue };\n}\n@NgModule({\n\texports: [MaskDirective, MaskPipe],\n\tdeclarations: [MaskDirective, MaskPipe],\n})\nexport class NgxMaskModule {\n\tpublic static forRoot(\n\t\tconfigValue?: optionsConfig | (() => optionsConfig),\n\t): ModuleWithProviders<NgxMaskModule> {\n\t\treturn {\n\t\t\tngModule: NgxMaskModule,\n\t\t\tproviders: [\n\t\t\t\t{\n\t\t\t\t\tprovide: NEW_CONFIG,\n\t\t\t\t\tuseValue: configValue,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprovide: INITIAL_CONFIG,\n\t\t\t\t\tuseValue: initialConfig,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprovide: config,\n\t\t\t\t\tuseFactory: _configFactory,\n\t\t\t\t\tdeps: [INITIAL_CONFIG, NEW_CONFIG],\n\t\t\t\t},\n\t\t\t\tMaskApplierService,\n\t\t\t],\n\t\t};\n\t}\n\n\tpublic static forChild(): ModuleWithProviders<NgxMaskModule> {\n\t\treturn {\n\t\t\tngModule: NgxMaskModule,\n\t\t};\n\t}\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\ndeclare var global: any;\n\nconst commonjsGlobal =\n\ttypeof globalThis !== 'undefined'\n\t\t? globalThis\n\t\t: typeof window !== 'undefined'\n\t\t? window\n\t\t: typeof global !== 'undefined'\n\t\t? global\n\t\t: typeof self !== 'undefined'\n\t\t? self\n\t\t: {};\n\n(function () {\n\tif (!commonjsGlobal.KeyboardEvent) {\n\t\tcommonjsGlobal.KeyboardEvent = function (_eventType: any, _init: any) {};\n\t}\n})();\n\nexport type CustomKeyboardEvent = KeyboardEvent;\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}